"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@nestjs/common"),t=require("merge-deep"),r=require("zod");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=n(t);function a(e){return null==e?void 0:e.isZodDto}class i extends e.BadRequestException{constructor(t){super({statusCode:e.HttpStatus.BAD_REQUEST,message:"Validation failed",errors:t.errors}),this.error=t}getZodError(){return this.error}}const o=e=>new i(e);var d=(e,t,r)=>new Promise(((n,s)=>{var a=e=>{try{o(r.next(e))}catch(e){s(e)}},i=e=>{try{o(r.throw(e))}catch(e){s(e)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);o((r=r.apply(e,t)).next())}));function c(e,t){return d(this,arguments,(function*(e,t,r=o){const n=a(t)?t.schema:t,s=yield n.safeParseAsync(e);if(!s.success)throw r(s.error);return s.data}))}var u=Object.defineProperty,m=Object.getOwnPropertyDescriptor;function l({createValidationException:t}={}){let r=class{constructor(e,t){this.source=e,this.schemaOrDto=t}canActivate(e){return c(e.switchToHttp().getRequest()[this.source],this.schemaOrDto,t),!0}};return r=((e,t,r,n)=>{for(var s,a=n>1?void 0:n?m(t,r):t,i=e.length-1;i>=0;i--)(s=e[i])&&(a=(n?s(t,r,a):s(a))||a);return n&&a&&u(t,r,a),a})([e.Injectable()],r),r}const p=l();function f(e){return t=>{if(!function(e){var t;return"custom"===e.code&&(null==(t=e.params)?void 0:t.isNestJsZod)}(t))return{matched:!1};const r=e(t.params);return r.matched?r:{matched:!1}}}function h(e,t){return n=>{if(n.code!==r.ZodIssueCode.too_small&&n.code!==r.ZodIssueCode.too_big)return{matched:!1};if(n.type!==e)return{matched:!1};const s=t(n);return s.matched?s:{matched:!1}}}const g=f((e=>{if("invalid_date_string"===e.code){return{matched:!0,message:"Invalid string, expected it to be a valid date"}}if("invalid_date_string_format"===e.code){return{matched:!0,message:`Invalid date, expected it to match ${{date:'YYYY-MM-DD (RFC3339 "full-date")',"date-time":'YYYY-MM-DDTHH:mm:ssZ (RFC3339 "date-time")'}[e.expected]}`}}if("invalid_date_string_direction"===e.code){return{matched:!0,message:`Invalid date, expected it to be the ${e.expected}`}}if("invalid_date_string_day"===e.code){return{matched:!0,message:`Invalid date, expected it to be a ${{weekDay:"week day",weekend:"weekend"}[e.expected]}`}}return{matched:!1}})),y=h("date_string_year",(e=>{if(e.code===r.ZodIssueCode.too_small){return{matched:!0,message:`Year must be greater than ${e.inclusive?"or equal to ":""}${e.minimum}`}}if(e.code===r.ZodIssueCode.too_big){return{matched:!0,message:`Year must be less than ${e.inclusive?"or equal to ":""}${e.maximum}`}}return{matched:!1}})),_=f((e=>{if("invalid_password_no_digit"===e.code){return{matched:!0,message:"Password must contain at least one digit"}}if("invalid_password_no_lowercase"===e.code){return{matched:!0,message:"Password must contain at least one lowercase letter"}}if("invalid_password_no_uppercase"===e.code){return{matched:!0,message:"Password must contain at least one uppercase letter"}}if("invalid_password_no_special"===e.code){return{matched:!0,message:"Password must contain at least one special symbol"}}return{matched:!1}})),v=h("password",(e=>{if(e.code===r.ZodIssueCode.too_small){return{matched:!0,message:`Password length must be greater than ${e.inclusive?"or equal to ":""}${e.minimum}`}}if(e.code===r.ZodIssueCode.too_big){return{matched:!0,message:`Password length must be less than ${e.inclusive?"or equal to ":""}${e.maximum}`}}return{matched:!1}})),k=(x=[g,y,_,v],e=>{for(const t of x){const r=t(e);if(r.matched)return r}return{matched:!1}});var x;var Z;function b(e,t){r.addIssueToContext(e,t)}function w(e){return"string"==typeof e?{message:e}:e}function O(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid" or "required" in conjunction with custom error map.');if(t)return{errorMap:t,description:s};return{errorMap:(t,r)=>"invalid_type"!==t.code?{message:r.defaultError}:void 0===r.data&&n?{message:n}:e.invalid_type_error?{message:e.invalid_type_error}:{message:r.defaultError},description:s}}function I(e,t){return e.find((e=>e.kind===t))}Z=(e,t)=>{const n=k(e);return n.matched?{message:n.message}:r.defaultErrorMap(e,t)},r.setErrorMap(Z),r.z.union([r.z.string(),r.z.number(),r.z.boolean()]);var P=(e=>(e.ZodDateString="ZodDateString",e.ZodPassword="ZodPassword",e))(P||{}),j=Object.defineProperty,D=Object.defineProperties,C=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,N=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,E=(e,t)=>{for(var r in t||(t={}))T.call(t,r)&&N(e,r,t[r]);if(L)for(var r of L(t))Y.call(t,r)&&N(e,r,t[r]);return e};const $={date:/^\d{4}-\d{2}-\d{2}$/,"date-time":/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(|\.\d{3})(Z|[+-]\d{2}:\d{2})$/},q=class extends r.ZodType{_parse(e){const t=this._getType(e),n=this._getOrReturnCtx(e);if(t!==r.ZodParsedType.string)return b(n,{code:r.ZodIssueCode.invalid_type,expected:r.ZodParsedType.string,received:n.parsedType}),r.INVALID;const s=new Date(e.data);if(Number.isNaN(s.getTime()))return b(n,{code:r.ZodIssueCode.custom,message:"Invalid date string",params:{isNestJsZod:!0,code:"invalid_date_string"}}),r.INVALID;const a=new r.ParseStatus;for(const t of this._def.checks)if("format"===t.kind){if(t.regex.test(e.data))continue;b(n,{code:r.ZodIssueCode.custom,message:t.message,params:{isNestJsZod:!0,code:"invalid_date_string_format",expected:t.value}}),a.dirty()}else if("direction"===t.kind){if({past:s<new Date,future:s>new Date}[t.direction])continue;b(n,{code:r.ZodIssueCode.custom,message:t.message,params:{isNestJsZod:!0,code:"invalid_date_string_direction",expected:t.direction}}),a.dirty()}else if("day-type"===t.kind){const e=s.getDay();if({weekDay:0!==e&&6!==e,weekend:0===e||6===e}[t.type])continue;b(n,{code:r.ZodIssueCode.custom,message:t.message,params:{isNestJsZod:!0,code:"invalid_date_string_day",expected:t.type}}),a.dirty()}else if("minYear"===t.kind){if(s.getFullYear()>=t.value)continue;b(n,{code:r.ZodIssueCode.too_small,type:"date_string_year",minimum:t.value,inclusive:!0,message:t.message}),a.dirty()}else if("maxYear"===t.kind){if(s.getFullYear()<=t.value)continue;b(n,{code:r.ZodIssueCode.too_big,type:"date_string_year",maximum:t.value,inclusive:!0,message:t.message}),a.dirty()}return{status:a.value,value:e.data}}_replaceCheck(e){return new q((t=E({},this._def),r={checks:this._def.checks.filter((t=>t.kind!==e.kind)).concat(e)},D(t,C(r))));var t,r}format(e,t){return this._replaceCheck(E({kind:"format",value:e,regex:$[e]},w(t)))}past(e){return this._replaceCheck(E({kind:"direction",direction:"past"},w(e)))}future(e){return this._replaceCheck(E({kind:"direction",direction:"future"},w(e)))}weekDay(e){return this._replaceCheck(E({kind:"day-type",type:"weekDay"},w(e)))}weekend(e){return this._replaceCheck(E({kind:"day-type",type:"weekend"},w(e)))}minYear(e,t){return this._replaceCheck(E({kind:"minYear",value:e},w(t)))}maxYear(e,t){return this._replaceCheck(E({kind:"maxYear",value:e},w(t)))}cast(){return this.transform((e=>new Date(e)))}get format_(){return I(this._def.checks,"format")}get isPast(){var e;return"past"===(null==(e=I(this._def.checks,"direction"))?void 0:e.direction)}get isFuture(){var e;return"future"===(null==(e=I(this._def.checks,"direction"))?void 0:e.direction)}get isWeekDay(){var e;return"weekDay"===(null==(e=I(this._def.checks,"day-type"))?void 0:e.type)}get isWeekend(){var e;return"weekend"===(null==(e=I(this._def.checks,"day-type"))?void 0:e.type)}get minYear_(){return I(this._def.checks,"minYear")}get maxYear_(){return I(this._def.checks,"maxYear")}};let S=q;S.create=e=>new q(E({checks:[{kind:"format",value:"date-time",regex:$["date-time"]}],typeName:P.ZodDateString},O(e))),S.create;var M=Object.defineProperty,A=Object.defineProperties,R=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,B=(e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,J=(e,t)=>{for(var r in t||(t={}))V.call(t,r)&&B(e,r,t[r]);if(z)for(var r of z(t))F.call(t,r)&&B(e,r,t[r]);return e};const U=["digit","lowercase","uppercase","special"],G={digit:/\d/,lowercase:/[a-z]/,uppercase:/[A-Z]/,special:/[!?@#$%^&*{};.,:%â„–"|\\/()-_+=<>`~[\]'"]/};function H(e){return U.includes(e.kind)}const W=class extends r.ZodType{_parse(e){const t=this._getType(e),n=this._getOrReturnCtx(e);if(t!==r.ZodParsedType.string)return b(n,{code:r.ZodIssueCode.invalid_type,expected:r.ZodParsedType.string,received:n.parsedType}),r.INVALID;const s=new r.ParseStatus;for(const t of this._def.checks)if(H(t)){if(G[t.kind].test(e.data))continue;b(n,{code:r.ZodIssueCode.custom,message:t.message,params:{isNestJsZod:!0,code:`invalid_password_no_${t.kind}`}}),s.dirty()}else if("minLength"===t.kind){if(e.data.length>=t.value)continue;b(n,{code:r.ZodIssueCode.too_small,type:"password",minimum:t.value,inclusive:!0,message:t.message}),s.dirty()}else if("maxLength"===t.kind){if(e.data.length<=t.value)continue;b(n,{code:r.ZodIssueCode.too_big,type:"password",maximum:t.value,inclusive:!0,message:t.message}),s.dirty()}return{status:s.value,value:e.data}}_replaceCheck(e){return new W((t=J({},this._def),r={checks:this._def.checks.filter((t=>t.kind!==e.kind)).concat(e)},A(t,R(r))));var t,r}buildFullRegExp(){const e=[];for(const t of this._def.checks){if(!H(t))continue;const r=G[t.kind];e.push(`(?=.*${r.source})`)}if(0===e.length)return/^.*$/;const t=e.join("");return new RegExp(`^(?:${t}.*)$`)}atLeastOne(e,t){return this._replaceCheck(J({kind:e},w(t)))}min(e,t){return this._replaceCheck(J({kind:"minLength",value:e},w(t)))}max(e,t){return this._replaceCheck(J({kind:"maxLength",value:e},w(t)))}isAtLeastOne(e){return function(e,t){return Boolean(I(e,t))}(this._def.checks,e)}get minLength(){return I(this._def.checks,"minLength")}get maxLength(){return I(this._def.checks,"maxLength")}};let Q=W;function K(e,t){return t.name===e.constructor.name}function X(e){const t={};if(e.description&&(t.description=e.description),K(e,r.ZodString)){const{checks:r}=e._def;t.type="string";for(const e of r)"min"===e.kind?t.minLength=e.value:"max"===e.kind?t.maxLength=e.value:"email"===e.kind?t.format="email":"url"===e.kind?t.format="uri":"uuid"===e.kind?t.format="uuid":"cuid"===e.kind?t.format="cuid":"regex"===e.kind&&(t.pattern=e.regex.source)}if(K(e,Q)){const{checks:r}=e._def,n=e.buildFullRegExp();t.type="string",t.format="password",t.pattern=n.source;for(const e of r)"minLength"===e.kind?t.minLength=e.value:"maxLength"===e.kind&&(t.maxLength=e.value)}if(K(e,r.ZodBoolean)&&(t.type="boolean"),K(e,r.ZodNumber)){const{checks:r}=e._def;t.type="number";for(const e of r)"int"===e.kind?t.type="integer":"min"===e.kind?(t.minimum=e.value,t.exclusiveMinimum=!e.inclusive):"max"===e.kind?(t.maximum=e.value,t.exclusiveMaximum=!e.inclusive):"multipleOf"===e.kind&&(t.multipleOf=e.value)}if(K(e,S)){const{checks:r}=e._def;t.type="string";for(const e of r)"format"===e.kind&&(t.format=e.value)}if(K(e,r.ZodBigInt)&&(t.type="integer",t.format="int64"),K(e,r.ZodArray)){const{minLength:r,maxLength:n,type:s}=e._def;t.type="array",r&&(t.minItems=r.value),n&&(t.maxItems=n.value),t.items=X(s)}if(K(e,r.ZodTuple)){const{items:r}=e._def;t.type="array",t.items={oneOf:r.map(X)}}if(K(e,r.ZodSet)){const{valueType:r,minSize:n,maxSize:s}=e._def;t.type="array",n&&(t.minItems=n.value),s&&(t.maxItems=s.value),t.items=X(r),t.uniqueItems=!0}if(K(e,r.ZodUnion)){const{options:r}=e._def;t.oneOf=r.map(X)}if(K(e,r.ZodDiscriminatedUnion)){const{options:r}=e._def;t.oneOf=[];for(const e of r.values())t.oneOf.push(X(e))}if(K(e,r.ZodLiteral)){const{value:r}=e._def;"string"==typeof r&&(t.type="string",t.enum=[r]),"number"==typeof r&&(t.type="number",t.minimum=r,t.maximum=r),"boolean"==typeof r&&(t.type="boolean")}if(K(e,r.ZodEnum)){const{values:r}=e._def;t.type="string",t.enum=r}if(K(e,r.ZodNativeEnum)){const{values:r}=e._def;t.type="string",t.enum=Object.values(r)}if(K(e,r.ZodTransformer)){const{schema:r}=e._def;Object.assign(t,X(r))}if(K(e,r.ZodNullable)){const{innerType:r}=e._def;Object.assign(t,X(r)),t.nullable=!0}if(K(e,r.ZodOptional)){const{innerType:r}=e._def;Object.assign(t,X(r))}if(K(e,r.ZodDefault)){const{defaultValue:r,innerType:n}=e._def;Object.assign(t,X(n)),t.default=r()}if(K(e,r.ZodObject)){const{shape:n}=e._def;t.type="object",t.properties={},t.required=[];for(const[e,s]of Object.entries(n())){t.properties[e]=X(s);[r.ZodOptional.name,r.ZodDefault.name].includes(s.constructor.name)||t.required.push(e)}0===t.required.length&&delete t.required}if(K(e,r.ZodRecord)){const{valueType:r}=e._def;t.type="object",t.additionalProperties=X(r)}if(K(e,r.ZodIntersection)){const{left:r,right:n}=e._def,a=s.default(X(r),X(n));Object.assign(t,a)}return t}Q.create=e=>new W(J({checks:[],typeName:P.ZodPassword},O(e))),Q.create;var ee=Object.defineProperty,te=Object.getOwnPropertyDescriptor;function re({createValidationException:t}={}){let r=class{constructor(e){this.schemaOrDto=e}transform(e,r){if(this.schemaOrDto)return c(e,this.schemaOrDto,t);const{metatype:n}=r;return a(n)?c(e,n.schema,t):e}};return r=((e,t,r,n)=>{for(var s,a=n>1?void 0:n?te(t,r):t,i=e.length-1;i>=0;i--)(s=e[i])&&(a=(n?s(t,r,a):s(a))||a);return n&&a&&ee(t,r,a),a})([e.Injectable()],r),r}const ne=re();exports.UseZodGuard=(t,r)=>e.UseGuards(new p(t,r)),exports.ZodGuard=p,exports.ZodValidationException=i,exports.ZodValidationPipe=ne,exports.createZodDto=function(e){class t{static create(e){return t=this,r=null,n=function*(){return yield this.schema.safeParseAsync(e)},new Promise(((e,s)=>{var a=e=>{try{o(n.next(e))}catch(e){s(e)}},i=e=>{try{o(n.throw(e))}catch(e){s(e)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,i);o((n=n.apply(t,r)).next())}));var t,r,n}}return t.isZodDto=!0,t.schema=e,t},exports.createZodGuard=l,exports.createZodValidationPipe=re,exports.patchNestJsSwagger=function(e=function(){return require("@nestjs/swagger/dist/services/schema-object-factory").SchemaObjectFactory}()){if(e.prototype.__patchedWithLoveByNestjsZod)return;const t=e.prototype.exploreModelSchema;e.prototype.exploreModelSchema=function(e,r,n){if(this.isLazyTypeFunc(e)){e=e()}return a(e)?(r[e.name]=X(e.schema),e.name):t(e,r,n)},e.prototype.__patchedWithLoveByNestjsZod=!0},exports.zodToOpenAPI=X;
